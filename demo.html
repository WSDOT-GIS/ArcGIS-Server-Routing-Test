<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style>
		iframe {
			width: 640px;
			height: 480px;
		}
		/*iframe[data-route-limit='1'] {
			width: 320px;
			height: 240px;
		}*/
		iframe + table {
			display: inline-table;
			vertical-align: top;
		}
		table, th, td {
			border: 0.1em solid black;
		}
	</style>
</head>
<body>
	<section>
		<h1>Unlimited features</h1>
		<iframe id="defaultFunctionality" src="routeLocator.html" sandbox="allow-scripts allow-same-origin"></iframe>
		<table id="routeTable">
			<thead>
				<tr><th>Route Name</th><th>Options</th></tr>
			</thead>
			<tbody>

			</tbody>
		</table>
	</section>
	<!--<section>
		<h1>Restricted to a single route</h1>
		<p>This iframe has a <code>data-route-limit="1"</code> attribute specified. Only one route can be added to this map.</p>
		<iframe id="singleRouteLimit" src="routeLocator.html" sandbox="allow-scripts allow-same-origin" data-route-limit="1"></iframe>
	</section>-->
	<script>
		(function () {
			"use strict";

			/** Sends a "delete" message to the window inside of the iframe.
			 * @param {MouseEvent}
			 * @this {HTMLButtonElement}
			 */
			function sendRouteDeleteMessage(e) {
				var button = e.target || e.srcElement || e.toElement;
				var routeName = button.value;
				window.frames[0].postMessage({
					action: "delete",
					name: routeName
				}, [location.protocol, location.host].join("//"));
			}

			window.addEventListener("message", function (/** {MessageEvent} */ e) {
				var table, row, cell, deleteButton, qs;
				if (e.data.layerId === "routes") {
					table = document.getElementById("routeTable");
					if (e.data.action === "added") {
						// Add a row to the table for the added route.
						row = table.insertRow(-1);
						row.dataset.routeName = e.data.name;
						cell = row.insertCell(-1);
						cell.innerText = e.data.name;
						cell = row.insertCell(-1);
						// Create a button that, when clicked, will delete the corresponding route in the map.
						deleteButton = document.createElement("button");
						deleteButton.type = "button";
						deleteButton.value = e.data.name;
						deleteButton.innerText = "Delete";
						deleteButton.addEventListener("click", sendRouteDeleteMessage, true);
						cell.appendChild(deleteButton);
					} else if (e.data.action === "removed") {
						// Remove the row from the table corresponding to the removed route.
						qs = document.querySelector("tr[data-route-name='" + e.data.name + "']");
						qs.remove();
					}
				}
			});
		}());
	</script>
</body>
</html>
