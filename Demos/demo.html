<!DOCTYPE html>
<html>
<head>
	<title>Demo</title>
	<style>
		iframe {
			width: 640px;
			height: 480px;
		}
		iframe + table {
			display: inline-table;
			vertical-align: top;
		}
		table, th, td {
			border: 0.1em solid black;
		}
	</style>
</head>
<body>
	<h1>Route locator demo</h1>
	<p>This page demonstrates the route locator control.</p>
	<section>
		<iframe id="defaultFunctionality" src="../routeLocator.html" sandbox="allow-scripts allow-same-origin"></iframe>
		<table id="routeTable">
			<thead>
				<tr><th>Route Name</th><th>Options</th></tr>
			</thead>
			<tbody></tbody>
		</table>
	</section>
	<section>
		<h1>Adding routes</h1>
		<ul>
			<li>Click on an intersection</li>
			<li>Click on a second intersection</li>
			<li>Once you have located two intersections, you can double-click anywhere on the map to find a route between the two intersection points.</li>
			<li>You can continue in this fashon to add more routes.</li>
		</ul>
	</section>
	<section>
		<h1>Removing Routes</h1>
		<ul>
			<li>You can click the <em>Delete</em> button to delete the last route that was added to the map.</li>
			<li>You can click the <em>Clear</em> button to delete all routes from the map.</li>
		</ul>
	</section>
	<section>
		<h1>Communicating with the control</h1>
		<p>The host page can send messages to the control that will add or remove routes from the map.</p>
	</section>

	<script>
		(function () {
			"use strict";

			/** Sends a "delete" message to the window inside of the iframe.
			 * @param {MouseEvent}
			 * @this {HTMLButtonElement}
			 */
			function sendRouteDeleteMessage(e) {
				var button, routeName;
				// Get the button that was clicked.
				button = e.target || e.srcElement || e.toElement;
				// The name of the associated route is stored in the button's "value" attribute.
				routeName = button.value;
				// Since there is only one iframe on this page, we know that window.frames[0]
				// will return the window inside of that iframe.
				//
				// Post a "delete" message to the window in the iframe.
				window.frames[0].postMessage({
					action: "delete",
					name: routeName
				}, [location.protocol, location.host].join("//"));
			}

			window.addEventListener("message", function (/** {MessageEvent} */ e) {
				var table, row, cell, deleteButton, qs;
				if (e.data.layerId === "routes") {
					table = document.getElementById("routeTable");
					if (e.data.action === "added") {
						// Add a row to the table for the added route.
						row = table.insertRow(-1);
						row.dataset.routeName = e.data.name;
						
						cell = row.insertCell(-1);
						cell.innerText = e.data.name;
						cell = row.insertCell(-1);
						// Create a button that, when clicked, will delete the corresponding route in the map.
						deleteButton = document.createElement("button");
						deleteButton.type = "button";
						deleteButton.value = e.data.name;
						deleteButton.innerText = "Delete";
						deleteButton.addEventListener("click", sendRouteDeleteMessage, true);
						cell.appendChild(deleteButton);
					} else if (e.data.action === "removed") {
						// Remove the row from the table corresponding to the removed route.
						qs = document.querySelector("tr[data-route-name='" + e.data.name + "']");
						qs.remove();
					}
				}
			});
		}());
	</script>
</body>
</html>
